openapi: 3.0.0
info:
  title: SubConverter Go API
  description: é«˜æ€§èƒ½ä»£ç†è®¢é˜…è½¬æ¢æœåŠ¡API
  version: 1.0.0
  contact:
    name: API Support
    email: support@subconverter.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8080
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: https://api.subconverter.com
    description: ç”Ÿäº§æœåŠ¡å™¨

paths:
  /api/v1/convert:
    post:
      summary: è½¬æ¢è®¢é˜…URL
      description: å°†ä»£ç†è®¢é˜…URLè½¬æ¢ä¸ºæŒ‡å®šæ ¼å¼çš„é…ç½®æ–‡ä»¶
      tags:
        - Conversion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConvertRequest'
      responses:
        '200':
          description: è½¬æ¢æˆåŠŸ
          content:
            application/x-yaml:
              schema:
                type: string
                description: ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å†…å®¹
              examples:
                clash:
                  summary: Clashé…ç½®ç¤ºä¾‹
                  value: |
                    port: 7890
                    socks-port: 7891
                    allow-lan: true
                    mode: Rule
                    log-level: info
                    proxies:
                      - name: "æµ‹è¯•èŠ‚ç‚¹"
                        type: ss
                        server: 127.0.0.1
                        port: 8388
                        cipher: aes-256-gcm
                        password: test123
        '400':
          $ref: '#/components/responses/BadRequest'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':


    get:
      summary: ç›´æ¥åˆå¹¶è®¢é˜…ï¼ˆGETï¼‰
      description: é€šè¿‡æŸ¥è¯¢å‚æ•°ç›´æ¥åˆå¹¶è®¢é˜…ä¸è‡ªå®šä¹‰é“¾æ¥å¹¶è¿”å›ç›®æ ‡æ ¼å¼é…ç½®ï¼ˆé€‚ç”¨äºå®¢æˆ·ç«¯ç›´æ¥è®¢é˜…ï¼‰ã€‚æ”¯æŒé‡å¤ url å‚æ•°æˆ–ä½¿ç”¨ urls é€—å·åˆ†éš”ã€‚
      tags:
        - Conversion
      parameters:
        - in: query
          name: target
          schema:
            type: string
            enum: [clash, surge, quantumult, loon, v2ray, surfboard]
          description: ç›®æ ‡æ ¼å¼ï¼ˆé»˜è®¤ clashï¼‰
        - in: query
          name: url
          schema:
            type: string
          description: è®¢é˜…æˆ–èŠ‚ç‚¹é“¾æ¥ï¼ˆå¯é‡å¤ï¼‰
          explode: true
        - in: query
          name: urls
          schema:
            type: string
          description: ä»¥é€—å·åˆ†éš”çš„ä¸€ç»„è®¢é˜…æˆ–èŠ‚ç‚¹é“¾æ¥
        - in: query
          name: include
          schema:
            type: string
          description: åŒ…å«çš„èŠ‚ç‚¹å…³é”®è¯ï¼ˆå¯é‡å¤ï¼‰
          explode: true
        - in: query
          name: exclude
          schema:
            type: string
          description: æ’é™¤çš„èŠ‚ç‚¹å…³é”®è¯ï¼ˆå¯é‡å¤ï¼‰
          explode: true
        - in: query
          name: include_remarks
          schema:
            type: string
          description: åŒ…å«çš„èŠ‚ç‚¹å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰
        - in: query
          name: exclude_remarks
          schema:
            type: string
          description: æ’é™¤çš„èŠ‚ç‚¹å…³é”®è¯ï¼ˆé€—å·åˆ†éš”ï¼‰
        - in: query
          name: sort
          schema:
            type: boolean
          description: æŒ‰åç§°æ’åº
        - in: query
          name: udp
          schema:
            type: boolean
          description: å¯ç”¨UDP
        - in: query
          name: rule
          schema:
            type: string
          description: è‡ªå®šä¹‰è§„åˆ™ï¼ˆå¯é‡å¤ï¼‰
          explode: true
        - in: query
          name: rules
          schema:
            type: string
          description: è‡ªå®šä¹‰è§„åˆ™ï¼ˆé€—å·åˆ†éš”ï¼‰
        - in: query
          name: rename
          schema:
            type: string
          description: é‡å‘½åè§„åˆ™ï¼Œæ ¼å¼ old->newï¼ˆå¯é‡å¤ï¼‰
          explode: true
        - in: query
          name: emoji
          schema:
            type: string
          description: emoji è§„åˆ™ï¼Œæ ¼å¼ match:ğŸ˜Šï¼ˆå¯é‡å¤ï¼‰
          explode: true
        - in: query
          name: base_template
          schema:
            type: string
          description: åŸºç¡€æ¨¡æ¿å
        - in: query
          name: base
          schema:
            type: string
          description: åŸºç¡€æ¨¡æ¿åï¼ˆåˆ«åï¼‰
      responses:
        '200':
          description: è½¬æ¢æˆåŠŸ
          content:
            application/x-yaml:
              schema:
                type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'
          $ref: '#/components/responses/InternalError'

  /api/v1/convert/batch:
    post:
      summary: æ‰¹é‡è½¬æ¢è®¢é˜…URL
      description: åŒæ—¶å¤„ç†å¤šä¸ªè®¢é˜…URLçš„è½¬æ¢è¯·æ±‚
      tags:
        - Conversion
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchConvertRequest'
      responses:
        '200':
          description: æ‰¹é‡è½¬æ¢æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchConvertResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '429':
          $ref: '#/components/responses/RateLimited'
        '500':
          $ref: '#/components/responses/InternalError'

  /api/v1/validate:
    post:
      summary: éªŒè¯è®¢é˜…URL
      description: éªŒè¯è®¢é˜…URLçš„æœ‰æ•ˆæ€§å’Œæ ¼å¼
      tags:
        - Validation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ValidateRequest'
      responses:
        '200':
          description: éªŒè¯ç»“æœ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidateResponse'

  /api/v1/info:
    get:
      summary: è·å–æœåŠ¡ä¿¡æ¯
      description: è¿”å›æœåŠ¡ç‰ˆæœ¬å’Œæ”¯æŒçš„æ ¼å¼ä¿¡æ¯
      tags:
        - Information
      responses:
        '200':
          description: æœåŠ¡ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/InfoResponse'

  /api/v1/health:
    get:
      summary: å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥æœåŠ¡å„ç»„ä»¶çš„å¥åº·çŠ¶æ€
      tags:
        - Health
      responses:
        '200':
          description: å¥åº·çŠ¶æ€
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /api/v1/formats:
    get:
      summary: è·å–æ”¯æŒçš„æ ¼å¼
      description: è¿”å›æ‰€æœ‰æ”¯æŒçš„è½¬æ¢æ ¼å¼
      tags:
        - Information
      responses:
        '200':
          description: æ”¯æŒçš„æ ¼å¼åˆ—è¡¨
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FormatsResponse'

  /:
    get:
      summary: æ ¹è·¯å¾„
      description: è¿”å›æœåŠ¡åŸºæœ¬ä¿¡æ¯
      tags:
        - Information
      responses:
        '200':
          description: æœåŠ¡åŸºæœ¬ä¿¡æ¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RootResponse'

  /docs:
    get:
      summary: è·å–APIæ–‡æ¡£
      description: è¿”å›APIä½¿ç”¨æ–‡æ¡£
      tags:
        - Documentation
      responses:
        '200':
          description: APIæ–‡æ¡£
          content:
            text/plain:
              schema:
                type: string



  /sub:
    get:
      summary: åˆå¹¶è®¢é˜…åˆ«åï¼ˆGETï¼‰
      description: ç­‰ä»·äº GET /api/v1/convertï¼Œä¾¿äºå®¢æˆ·ç«¯ç›´æ¥è®¢é˜…ä½¿ç”¨ã€‚
      tags:
        - Conversion
      parameters:
        - in: query
          name: target
          schema:
            type: string
          description: ç›®æ ‡æ ¼å¼ï¼ˆé»˜è®¤ clashï¼‰
        - in: query
          name: url
          schema:
            type: string
          description: è®¢é˜…æˆ–èŠ‚ç‚¹é“¾æ¥ï¼ˆå¯é‡å¤ï¼‰
          explode: true
        - in: query
          name: urls
          schema:
            type: string
          description: ä»¥é€—å·åˆ†éš”çš„ä¸€ç»„è®¢é˜…æˆ–èŠ‚ç‚¹é“¾æ¥
      responses:
        '200':
          description: è½¬æ¢æˆåŠŸ
          content:
            application/x-yaml:
              schema:
                type: string
components:
  schemas:
    ConvertRequest:
      type: object
      required:
        - target
        - urls
      properties:
        target:
          type: string
          description: ç›®æ ‡æ ¼å¼
          enum: [clash, surge, quantumult, loon, v2ray, surfboard]
          example: clash
        urls:
          type: array
          items:
            type: string
            format: uri
          description: è®¢é˜…URLåˆ—è¡¨
          example: ["https://example.com/subscription"]
        config:
          type: string
          format: uri
          description: è‡ªå®šä¹‰é…ç½®æ–‡ä»¶URL
          example: https://example.com/config.yaml
        options:
          $ref: '#/components/schemas/ConvertOptions'

    ConvertOptions:
      type: object
      properties:
        include_remarks:
          type: array
          items:
            type: string
          description: åŒ…å«çš„èŠ‚ç‚¹åç§°å…³é”®è¯
          example: ["é¦™æ¸¯", "æ—¥æœ¬"]
        exclude_remarks:
          type: array
          items:
            type: string
          description: æ’é™¤çš„èŠ‚ç‚¹åç§°å…³é”®è¯
          example: ["æµ‹è¯•", "è¿‡æœŸ"]
        sort:
          type: boolean
          description: æ˜¯å¦æŒ‰åç§°æ’åºèŠ‚ç‚¹
          default: true
          example: true
        udp:
          type: boolean
          description: æ˜¯å¦å¯ç”¨UDPæ”¯æŒ
          default: true
          example: true
        rename_rules:
          type: array
          items:
            $ref: '#/components/schemas/RenameRule'
          description: èŠ‚ç‚¹é‡å‘½åè§„åˆ™
        emoji_rules:
          type: array
          items:
            $ref: '#/components/schemas/EmojiRule'
          description: èŠ‚ç‚¹emojiè§„åˆ™
        rules:
          type: array
          items:
            type: string
          description: è‡ªå®šä¹‰è§„åˆ™
          example: ["DOMAIN-SUFFIX,google.com,ğŸš€ èŠ‚ç‚¹é€‰æ‹©"]
        proxy_groups:
          type: array
          items:
            $ref: '#/components/schemas/ProxyGroup'
          description: ä»£ç†ç»„é…ç½®

    RenameRule:
      type: object
      properties:
        match:
          type: string
          description: åŒ¹é…å…³é”®è¯
          example: "é¦™æ¸¯"
        replace:
          type: string
          description: æ›¿æ¢å†…å®¹
          example: "HK"

    EmojiRule:
      type: object
      properties:
        match:
          type: string
          description: åŒ¹é…å…³é”®è¯
          example: "é¦™æ¸¯"
        emoji:
          type: string
          description: Emojiå­—ç¬¦
          example: "ğŸ‡­ğŸ‡°"

    ProxyGroup:
      type: object
      required:
        - name
        - type
      properties:
        name:
          type: string
          description: ä»£ç†ç»„åç§°
          example: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
        type:
          type: string
          description: ä»£ç†ç»„ç±»å‹
          enum: [select, url-test, fallback, load-balance]
          example: select
        proxies:
          type: array
          items:
            type: string
          description: åŒ…å«çš„ä»£ç†æˆ–ä»£ç†ç»„åç§°
          example: ["DIRECT", "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"]
        url:
          type: string
          description: æµ‹è¯•URLï¼ˆurl-test/fallback/load-balanceéœ€è¦ï¼‰
          example: "http://www.gstatic.com/generate_204"
        interval:
          type: integer
          description: æµ‹è¯•é—´éš”ï¼ˆç§’ï¼‰
          example: 300

    BatchConvertRequest:
      type: object
      required:
        - requests
      properties:
        requests:
          type: array
          items:
            $ref: '#/components/schemas/ConvertRequest'
          description: è½¬æ¢è¯·æ±‚åˆ—è¡¨

    ConvertResponse:
      type: object
      properties:
        config:
          type: string
          description: ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å†…å®¹
        format:
          type: string
          description: ç›®æ ‡æ ¼å¼
        proxies:
          type: array
          items:
            type: object
          description: ä»£ç†èŠ‚ç‚¹åˆ—è¡¨
        generated:
          type: string
          format: date-time
          description: ç”Ÿæˆæ—¶é—´

    BatchConvertResponse:
      type: object
      properties:
        results:
          type: array
          items:
            $ref: '#/components/schemas/ConvertResponse'
          description: è½¬æ¢ç»“æœåˆ—è¡¨
        errors:
          type: array
          items:
            type: string
          description: é”™è¯¯ä¿¡æ¯åˆ—è¡¨

    ValidateRequest:
      type: object
      required:
        - url
      properties:
        url:
          type: string
          format: uri
          description: è®¢é˜…URL
          example: https://example.com/subscription

    ValidateResponse:
      type: object
      properties:
        valid:
          type: boolean
          description: æ˜¯å¦æœ‰æ•ˆ
        format:
          type: string
          description: è®¢é˜…æ ¼å¼
        proxies:
          type: integer
          description: ä»£ç†èŠ‚ç‚¹æ•°é‡
        error:
          type: string
          description: é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

    InfoResponse:
      type: object
      properties:
        version:
          type: string
          description: æœåŠ¡ç‰ˆæœ¬
          example: 1.0.0
        supported_types:
          type: array
          items:
            type: string
          description: æ”¯æŒçš„æ ¼å¼åˆ—è¡¨
          example: [clash, surge, quantumult]
        features:
          type: array
          items:
            type: string
          description: åŠŸèƒ½ç‰¹æ€§åˆ—è¡¨
          example: ["High-performance conversion", "Multiple protocol support"]

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          description: æ€»ä½“çŠ¶æ€
          example: ok
        timestamp:
          type: string
          format: date-time
          description: æ£€æŸ¥æ—¶é—´
        services:
          type: object
          additionalProperties:
            type: string
          description: å„æœåŠ¡çŠ¶æ€
          example: {"cache": "healthy", "service": "healthy"}

    FormatsResponse:
      type: object
      properties:
        formats:
          type: array
          items:
            type: string
          description: æ”¯æŒçš„æ ¼å¼åˆ—è¡¨

    RootResponse:
      type: object
      properties:
        message:
          type: string
          example: SubConverter Go API
        version:
          type: string
          example: 1.0.0
        docs:
          type: string
          example: /docs

    Error:
      type: object
      properties:
        error:
          type: string
          description: é”™è¯¯ä¿¡æ¯
        code:
          type: string
          description: é”™è¯¯ä»£ç 
        details:
          type: object
          description: è¯¦ç»†é”™è¯¯ä¿¡æ¯

  responses:
    BadRequest:
      description: è¯·æ±‚å‚æ•°é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "æ— æ•ˆçš„è¯·æ±‚å‚æ•°"
            code: "INVALID_REQUEST"

    RateLimited:
      description: è¯·æ±‚é¢‘ç‡è¿‡é«˜
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "è¯·æ±‚é¢‘ç‡è¿‡é«˜ï¼Œè¯·ç¨åå†è¯•"
            code: "RATE_LIMITED"

    InternalError:
      description: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error: "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯"
            code: "INTERNAL_ERROR"

tags:
  - name: Conversion
    description: è®¢é˜…è½¬æ¢ç›¸å…³æ¥å£
  - name: Validation
    description: è®¢é˜…éªŒè¯ç›¸å…³æ¥å£
  - name: Health
    description: å¥åº·æ£€æŸ¥æ¥å£
  - name: Information
    description: æœåŠ¡ä¿¡æ¯æ¥å£
  - name: Documentation
    description: æ–‡æ¡£æ¥å£